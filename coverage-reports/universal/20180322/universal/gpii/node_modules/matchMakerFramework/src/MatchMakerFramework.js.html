<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for universal/gpii/node_modules/matchMakerFramework/src/MatchMakerFramework.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../../../index.html">All files</a> / <a href="index.html">universal/gpii/node_modules/matchMakerFramework/src</a> MatchMakerFramework.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">28.57% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>8/28</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/7</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">28.57% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>8/28</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
* Match Maker Framework
*
* Copyright 2014 Raising the Floor - International
*
* Licensed under the New BSD license. You may not use this file except in
* compliance with this License.
*
* The research leading to these results has received funding from the European Union's
* Seventh Framework Programme (FP7/2007-2013)
* under grant agreement no. 289016.
*
* You may obtain a copy of the License at
* https://github.com/GPII/universal/blob/master/LICENSE.txt
*/
&nbsp;
"use strict";
&nbsp;
var fluid = require("infusion"),
    gpii = fluid.registerNamespace("gpii"),
    semver = require("semver");
&nbsp;
fluid.registerNamespace("gpii.matchMakerFramework");
&nbsp;
fluid.defaults("gpii.matchMakerFramework", {
    gradeNames: ["fluid.component"],
    matchMakerUrl: "%matchMakerPath/match",
    components: {
        matchMakerService: {
            type: "kettle.dataSource.URL",
            options: {
                url: "{gpii.matchMakerFramework}.options.matchMakerUrl",
                writable: true,
                termMap: {
                    matchMakerPath: "noencode:%matchMakerPath"
                }
            }
        }
    },
    invokers: {
        preProcess: {
            funcName: "gpii.matchMakerFramework.preProcess",
            args: ["{that}", "{arguments}.0"]
        }, // initialPayload
        matchMakerDispatcher: {
            funcName: "gpii.matchMakerFramework.matchMakerDispatcher",
            args: ["{that}", "{arguments}.0"]
        }
    },
    events: {
        onSolutions: null
    }
});
&nbsp;
/*
 * responsible for building the input payload to the matchmaker, via a bunch of helper functions
 * initialPayload consists of:
 *    userToken, preferences, deviceContext, solutionsRegistryEntries
 */
gpii.matchMakerFramework.preProcess = <span class="fstat-no" title="function not covered" >fu</span>nction (that, initialPayload) {
    var matchMakerInput = <span class="cstat-no" title="statement not covered" >fluid.extend({</span>
        activeContexts: [ // TODO calculate properly
            "gpii-default"
        ],
        environmentReporter: {}, // TODO,
        inferredCommonTerms: gpii.matchMakerFramework.utils.inferCommonTerms(initialPayload.preferences, initialPayload.fullSolutionsRegistry)
    }, initialPayload);
    // remove full solutions registry from the payload, now that we've used it
    // to avoid sending a too large payload to the matchmaker (see GPII-1880)
<span class="cstat-no" title="statement not covered" >    delete matchMakerInput.fullSolutionsRegistry;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return matchMakerInput;</span>
};
&nbsp;
/**
 * Asynchronous function responsible for, given a matchMaker input payload, deciding which matchmaker is most
 * suitable to do the actual matching process and send the payload there. Once the matchmaker
 * returns its matched data, the event will be fired with both the returned and original data in a combined payload.
 *
 * @param that {Object} - object containing a matchMakerService datasource component which can be used
 *     when sending the data to the actual match maker
 * @param matchMakerInput {Object} - a valid input payload for the matchmakers
 * @param event {Object} - event to fire when the matchmaker has finished its matching
 */
gpii.matchMakerFramework.matchMakerDispatcher = <span class="fstat-no" title="function not covered" >fu</span>nction (that, matchMakerInput) {
    var matchMakerResponse = <span class="cstat-no" title="statement not covered" >fluid.extend({}, matchMakerInput);</span>
    // TODO: some algorithm to decide the MM
    var selectedMatchMaker = <span class="cstat-no" title="statement not covered" >"default";</span>
    var matchMakerPath = <span class="cstat-no" title="statement not covered" >that.options.matchMakers[selectedMatchMaker].url;</span>
<span class="cstat-no" title="statement not covered" >    fluid.log("MatchMaker Framework: dispatching to the " + selectedMatchMaker + " MatchMaker at path " + matchMakerPath);</span>
    var promise = <span class="cstat-no" title="statement not covered" >that.matchMakerService.set({</span>
        matchMakerPath: matchMakerPath
    }, matchMakerInput, { writeMethod: "POST" });
&nbsp;
    var outputPromise = <span class="cstat-no" title="statement not covered" >fluid.promise();</span>
<span class="cstat-no" title="statement not covered" >    promise.then(<span class="fstat-no" title="function not covered" >fu</span>nction (matchMakerOutput) {</span>
<span class="cstat-no" title="statement not covered" >        matchMakerResponse.matchMakerOutput = matchMakerOutput;</span>
<span class="cstat-no" title="statement not covered" >        outputPromise.resolve(matchMakerResponse);</span>
    }, <span class="fstat-no" title="function not covered" >fu</span>nction (err) { // TODO: This rejection handler is untested
<span class="cstat-no" title="statement not covered" >        outputPromise.reject(err);</span>
    });
<span class="cstat-no" title="statement not covered" >    return outputPromise;</span>
};
&nbsp;
/**
 * Takes a solutions registry object and filters out all solutions that do not match the ones
 * reported by the device reporter.
 *
 * @param solutions {Object} - solutions registry entries as retrieved from solutions registry
 * @param device {Object} - device reporter data as retrieved from the device reporter
 *
 * @return {Object} - the solutions registry object, but with all the solutions not matching
 *      the device filtered out
 */
gpii.matchMakerFramework.filterSolutions = <span class="fstat-no" title="function not covered" >fu</span>nction (solutions, device) {
<span class="cstat-no" title="statement not covered" >    return fluid.remove_if(fluid.copy(solutions), <span class="fstat-no" title="function not covered" >fu</span>nction (solution, solutionId) {</span>
        // Match on device solutions.
        var matchesSolutions = <span class="cstat-no" title="statement not covered" >fluid.find(device.solutions, <span class="fstat-no" title="function not covered" >fu</span>nction (devSolution) {</span>
<span class="cstat-no" title="statement not covered" >            if (devSolution.id === solutionId &amp;&amp;</span>
                (!solution.version ||
                 !devSolution.version ||
                 semver.satisfies(devSolution.version, solution.version)
                )) {
<span class="cstat-no" title="statement not covered" >                return true;</span>
            }
        });
<span class="cstat-no" title="statement not covered" >        if (!matchesSolutions) {</span>
<span class="cstat-no" title="statement not covered" >            return solutions;</span>
        }
    });
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Mon Mar 12 2018 14:05:59 GMT+0100 (CET)
</div>
</div>
<script src="../../../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../../../sorter.js"></script>
</body>
</html>
