<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for universal/gpii/node_modules/canopyMatchMaker/src/CanopyMatchMakerUtilities.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../../../index.html">All files</a> / <a href="index.html">universal/gpii/node_modules/canopyMatchMaker/src</a> CanopyMatchMakerUtilities.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">16.25% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>13/80</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">13.33% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>4/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">16.88% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>13/77</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*!
GPII Canopy Matchmaker
&nbsp;
Copyright 2012 OCAD University
Copyright 2012 Antranig Basman
&nbsp;
Licensed under the New BSD license. You may not use this file except in
compliance with this License.
&nbsp;
The research leading to these results has received funding from the European Union's
Seventh Framework Programme (FP7/2007-2013) under grant agreement no. 289016.
&nbsp;
You may obtain a copy of the License at
https://github.com/GPII/universal/blob/master/LICENSE.txt
*/
&nbsp;
"use strict";
&nbsp;
var fluid = fluid || require("infusion");
var gpii = gpii || fluid.registerNamespace("gpii");
&nbsp;
fluid.registerNamespace("gpii.canopyMatchMaker.utils");
&nbsp;
gpii.canopyMatchMaker.utils.computeFitness = <span class="fstat-no" title="function not covered" >fu</span>nction (leaves, solution, ontologicalMetricFunction) {
    var vector = <span class="cstat-no" title="statement not covered" >[];</span>
<span class="cstat-no" title="statement not covered" >    for (var i = 0; i &lt; leaves.length; ++i) {</span>
        var leaf = <span class="cstat-no" title="statement not covered" >leaves[i];</span>
<span class="cstat-no" title="statement not covered" >        vector[i] = ontologicalMetricFunction(leaf, solution);</span>
    }
<span class="cstat-no" title="statement not covered" >    vector = vector.sort(gpii.canopyMatchMaker.utils.sortDescending);</span>
<span class="cstat-no" title="statement not covered" >    return vector;</span>
};
&nbsp;
gpii.canopyMatchMaker.utils.compareFitness = <span class="fstat-no" title="function not covered" >fu</span>nction (solA, solB) {
    var i = <span class="cstat-no" title="statement not covered" >0,</span> fitA = <span class="cstat-no" title="statement not covered" >solA.fitness,</span> fitB = <span class="cstat-no" title="statement not covered" >solB.fitness;</span>
<span class="cstat-no" title="statement not covered" >    for (; ; ++i) {</span>
        var endA = <span class="cstat-no" title="statement not covered" >i === fitA.length,</span> endB = <span class="cstat-no" title="statement not covered" >i === fitB.length;</span>
<span class="cstat-no" title="statement not covered" >        if (endA || endB) {</span>
<span class="cstat-no" title="statement not covered" >            return endA &amp;&amp; endB ? 0 : (endB ? -1 : 1);</span>
        }
        var diff = <span class="cstat-no" title="statement not covered" >fitB[i] - fitA[i];</span>
<span class="cstat-no" title="statement not covered" >        if (diff !== 0) {</span>
<span class="cstat-no" title="statement not covered" >            return diff;</span>
        }
    }
};
&nbsp;
/*
 * @leaves {object}
 * @solrecs {object} map of solutions keyed by solution id.
 */
gpii.canopyMatchMaker.utils.sortSolutions = <span class="fstat-no" title="function not covered" >fu</span>nction (solutions) {
    var solArr = <span class="cstat-no" title="statement not covered" >[];</span>
<span class="cstat-no" title="statement not covered" >    for (var i in solutions) {</span>
<span class="cstat-no" title="statement not covered" >        solArr.push(solutions[i]);</span>
    }
<span class="cstat-no" title="statement not covered" >    return solArr.sort(gpii.canopyMatchMaker.utils.compareFitness);</span>
};
&nbsp;
/*
 * @leaves {object}
 * @solrecs {object} map of solutions keyed by solution id.
 */
gpii.canopyMatchMaker.utils.rankSolutions = <span class="fstat-no" title="function not covered" >fu</span>nction (leaves, solrecs, ontologicalMetricFunction) {
<span class="cstat-no" title="statement not covered" >    fluid.each(solrecs, <span class="fstat-no" title="function not covered" >fu</span>nction (solrec) {</span>
<span class="cstat-no" title="statement not covered" >        solrec.fitness = gpii.canopyMatchMaker.utils.computeFitness(leaves, solrec.skeleton, ontologicalMetricFunction);</span>
    });
    var solArr = <span class="cstat-no" title="statement not covered" >gpii.canopyMatchMaker.utils.sortSolutions(solrecs);</span>
<span class="cstat-no" title="statement not covered" >    return fluid.transform(solArr, <span class="fstat-no" title="function not covered" >fu</span>nction (value) {</span>
<span class="cstat-no" title="statement not covered" >        return value.index;</span>
    });
};
&nbsp;
/*
 * @leaves {object}
 * @solrecs {object} map of solutions keyed by solution id.
 */
gpii.canopyMatchMaker.utils.disposeStrategy = <span class="fstat-no" title="function not covered" >fu</span>nction (leaves, solrecs, data, ontologyMetadata) {
    var ontologicalMetricName = <span class="cstat-no" title="statement not covered" >fluid.get(ontologyMetadata, "ontologicalMetricFunction") || "gpii.canopyMatchMaker.utils.prefixLength";</span>
    var ontologicalMetricFunction = <span class="cstat-no" title="statement not covered" >fluid.getGlobalValue(ontologicalMetricName);</span>
    // if we already have priority for some solutions, accept these and reject any applications
    // of same type.
<span class="cstat-no" title="statement not covered" >    gpii.matchMakerFramework.utils.disposeFromPriority(solrecs, data);</span>
    // rank remaining solutions based on fit to preferences
    var ranked = <span class="cstat-no" title="statement not covered" >gpii.canopyMatchMaker.utils.rankSolutions(leaves, solrecs, ontologicalMetricFunction);</span>
    // dispose based on canopy
    var disposed = <span class="cstat-no" title="statement not covered" >gpii.canopyMatchMaker.utils.disposeFromCanopy(leaves, ranked, solrecs, data, ontologicalMetricFunction);</span>
    // re-key by solution id:
    var togo = <span class="cstat-no" title="statement not covered" >{};</span>
<span class="cstat-no" title="statement not covered" >    fluid.each(disposed, <span class="fstat-no" title="function not covered" >fu</span>nction (val) {</span>
<span class="cstat-no" title="statement not covered" >        togo[val.index] = val;</span>
    });
<span class="cstat-no" title="statement not covered" >    return togo;</span>
};
&nbsp;
gpii.canopyMatchMaker.utils.disposeFromCanopy = <span class="fstat-no" title="function not covered" >fu</span>nction (leaves, ranked, solrecs, data, ontologicalMetricFunction) {
    // Set default canopy to negative leaf depth. To raise the canopy, a preference needs to
    // match at least one level into the leaf.
    var canopy = <span class="cstat-no" title="statement not covered" >fluid.transform(leaves, <span class="fstat-no" title="function not covered" >fu</span>nction (leaf) {</span>
        var leafDepth = <span class="cstat-no" title="statement not covered" >fluid.pathUtil.parseEL(leaf).length;</span>
<span class="cstat-no" title="statement not covered" >        return -leafDepth;</span>
    });
&nbsp;
<span class="cstat-no" title="statement not covered" >    for (var i = 0; i &lt; ranked.length; ++i) {</span>
        var sol = <span class="cstat-no" title="statement not covered" >solrecs[ranked[i]];</span>
<span class="cstat-no" title="statement not covered" >        if (sol.disposition === "reject") {</span>
<span class="cstat-no" title="statement not covered" >            continue;</span>
        }
&nbsp;
        var inCanopy = <span class="cstat-no" title="statement not covered" >false;</span>
<span class="cstat-no" title="statement not covered" >        for (var j = 0; j &lt; leaves.length; ++j) {</span>
            var depth = <span class="cstat-no" title="statement not covered" >ontologicalMetricFunction(leaves[j], sol.skeleton);</span>
<span class="cstat-no" title="statement not covered" >            if (depth &gt; canopy[j]) {</span>
<span class="cstat-no" title="statement not covered" >                inCanopy = true;</span>
<span class="cstat-no" title="statement not covered" >                canopy[j] = depth;</span>
            }
        }
<span class="cstat-no" title="statement not covered" >        if (inCanopy) {</span>
<span class="cstat-no" title="statement not covered" >            sol.disposition = "accept";</span>
<span class="cstat-no" title="statement not covered" >            sol.dispositionReason = "Was the solution of this type that best fit user preferences";</span>
<span class="cstat-no" title="statement not covered" >            gpii.matchMakerFramework.utils.rejectFromTypes(data.solutionTypes[sol.index],</span>
                data.solutionTypeMapping, solrecs, "Another solution (" + sol.index +
                ") covering more preferences was found found.");
        } else {
<span class="cstat-no" title="statement not covered" >            sol.disposition = "reject";</span>
<span class="cstat-no" title="statement not covered" >            sol.dispositionReason = "Was not in canopy.";</span>
        }
    }
<span class="cstat-no" title="statement not covered" >    return solrecs;</span>
};
&nbsp;
/** Returns a non-positive number indicating by how many path segments the supplied
 * path fails to index correctly into the supplied model. A return value of 0
 * indicates that the path indexes fully
 */
gpii.canopyMatchMaker.utils.prefixLength = <span class="fstat-no" title="function not covered" >fu</span>nction (path, model) {
    var segs = <span class="cstat-no" title="statement not covered" >fluid.pathUtil.parseEL(path);</span>
<span class="cstat-no" title="statement not covered" >    for (var i = 0; i &lt; segs.length; ++i) {</span>
        var seg = <span class="cstat-no" title="statement not covered" >segs[i];</span>
<span class="cstat-no" title="statement not covered" >        model = model[seg];</span>
<span class="cstat-no" title="statement not covered" >        if (model === undefined) {</span>
<span class="cstat-no" title="statement not covered" >            return i - segs.length;</span>
        }
    }
<span class="cstat-no" title="statement not covered" >    return 0;</span>
};
&nbsp;
fluid.registerNamespace("gpii.canopyMatchMaker.utils.ISO24751");
&nbsp;
gpii.canopyMatchMaker.utils.ISO24751.ontologicalMetric = <span class="fstat-no" title="function not covered" >fu</span>nction (path, model) {
    var segs = <span class="cstat-no" title="statement not covered" >fluid.pathUtil.parseEL(path);</span>
    // if it's an application setting and the application is not matching, consider worst fit
<span class="cstat-no" title="statement not covered" >    if (segs[0] === "applications" &amp;&amp; fluid.get(model, ["applications", segs[1]]) === undefined) {</span>
<span class="cstat-no" title="statement not covered" >        return -Infinity;</span>
    } else { // else do fitting as usual
<span class="cstat-no" title="statement not covered" >        return gpii.canopyMatchMaker.utils.prefixLength(path, model);</span>
    }
};
&nbsp;
// only used by canopyMatchMaker - moved from MatchMakerFramework
gpii.canopyMatchMaker.utils.sortDescending = <span class="fstat-no" title="function not covered" >fu</span>nction (numA, numB) {
<span class="cstat-no" title="statement not covered" >    return numB - numA;</span>
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Mon Mar 12 2018 14:05:59 GMT+0100 (CET)
</div>
</div>
<script src="../../../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../../../sorter.js"></script>
</body>
</html>
