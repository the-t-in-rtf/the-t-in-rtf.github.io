<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for universal/gpii/node_modules/settingsHandlers/src/settingsHandlerUtilities.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../../../index.html">All files</a> / <a href="index.html">universal/gpii/node_modules/settingsHandlers/src</a> settingsHandlerUtilities.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">20.35% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>35/172</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">4.23% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>3/71</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">4.35% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>2/46</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">20.35% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>35/172</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">3x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*!
GPII Settings Handler Utilities
&nbsp;
Copyright 2013 OCAD University
&nbsp;
Licensed under the New BSD license. You may not use this file except in
compliance with this License.
&nbsp;
The research leading to these results has received funding from the European Union's
Seventh Framework Programme (FP7/2007-2013) under grant agreement no. 289016.
&nbsp;
You may obtain a copy of the License at
https://github.com/GPII/universal/blob/master/LICENSE.txt
*/
&nbsp;
"use strict";
&nbsp;
var fluid = fluid || require("infusion"),
    fs = typeof(require) === "undefined" ? <span class="branch-0 cbranch-no" title="branch not covered" >null </span>: require("fs"), // courtesy to run web-based tests for partial file contents
    kettle = fluid.registerNamespace("kettle"),
    gpii = fluid.registerNamespace("gpii");
&nbsp;
/***************************************************************************************************
 * Low-level settings handler utilities, of use to practically anyone dealing with settings handlers
 */
&nbsp;
// A useful utility to defer an activity by a fixed time, together with the necessary callback wrapping
// This or an equivalent MUST be used by anyone within the GPII who wishes to defer an activity
gpii.invokeLater = <span class="fstat-no" title="function not covered" >fu</span>nction (callback, time) {
    var wrapped = <span class="cstat-no" title="statement not covered" >kettle.wrapCallback ? kettle.wrapCallback(callback) : callback;</span>
<span class="cstat-no" title="statement not covered" >    return time ? setTimeout(wrapped, time) : fluid.invokeLater(wrapped);</span>
};
&nbsp;
// Low-quality utility to force resolution of a value which is known to be either
// a plain value or a synchronous promise
gpii.resolveSync = <span class="fstat-no" title="function not covered" >fu</span>nction (response) {
<span class="cstat-no" title="statement not covered" >    if (fluid.isPromise(response)) {</span>
<span class="cstat-no" title="statement not covered" >        response.then(<span class="fstat-no" title="function not covered" >fu</span>nction (resolved) {</span>
<span class="cstat-no" title="statement not covered" >            response = resolved;</span>
        });
    }
<span class="cstat-no" title="statement not covered" >    return response;</span>
};
&nbsp;
// Coerce a value or promise to a promise - this should really go in the core framework
gpii.toPromise = <span class="fstat-no" title="function not covered" >fu</span>nction (value) {
<span class="cstat-no" title="statement not covered" >    if (fluid.isPromise(value)) {</span>
<span class="cstat-no" title="statement not covered" >        return value;</span>
    } else {
        var togo = <span class="cstat-no" title="statement not covered" >fluid.promise();</span>
<span class="cstat-no" title="statement not covered" >        togo.resolve(value);</span>
<span class="cstat-no" title="statement not covered" >        return togo;</span>
    }
};
&nbsp;
fluid.registerNamespace("gpii.settingsHandlers");
&nbsp;
// TODO: These utilities all clearly form part of some wider idiom of "payload handling" without some underpinnings
// for which they are rather hard to follow. For example, they could benefit from some form of "JSON type system"
// (whether provided via JSON schema or otherwise) in order to provide landmarks within the payloads, as well
// as actually validating arguments to these functions and payloads in general.
// cf. some vaguely related art in F# "Type Providers": http://fsharp.github.io/FSharp.Data/library/JsonProvider.html
&nbsp;
/** A general utility function which helps in transforming settings handler payloads - these algorithms generally
 * must iterate over the two levels of containment (per-solution, per-settings) and then apply some transform
 * to the nested values
 * @param payload {Object} A settings handler payload (either GET/SET response or return). The top-level keys will be solution ids
 * @param handler {Function} A function whose signature is (oneSetting, [path], oneSolution) where -
 *    - oneSetting is the nested payload (i.e. the level containing "settings"/"options")
 *    - path is an array holding the path to this payload i.e. [solutionId, index]
 *    - oneSolution is the payload at the outer level of containment - i.e. payload[solutionId]
 * @return The transformed payload-structured value
 */
gpii.settingsHandlers.transformPayload = <span class="fstat-no" title="function not covered" >fu</span>nction (payload, handler) {
<span class="cstat-no" title="statement not covered" >    return fluid.transform(payload, <span class="fstat-no" title="function not covered" >fu</span>nction (oneSolution, solutionPath) {</span>
<span class="cstat-no" title="statement not covered" >        return fluid.transform(oneSolution, <span class="fstat-no" title="function not covered" >fu</span>nction (oneSetting, settingPath) {</span>
            var path = <span class="cstat-no" title="statement not covered" >[solutionPath, settingPath];</span>
<span class="cstat-no" title="statement not covered" >            return handler(oneSetting, path, oneSolution);</span>
        });
    });
};
&nbsp;
/** Transform the settings for one solution's worth of settings by a supplied transform.
 * @param oneSolution {Object} One solution's worth of settings, with a member named `settings` containing a free hash of the settings indexed by settingsHandlerBlock name
 * @param handler {Function} A transformer whose signature is the same as the 2nd argument to gpii.settingsHandlers.transformPayload
 * @param path {Array of String} (optional) An array of path segments holding the path of oneSolution within an overall payload - this will be used to form the 2nd argument of `handler`
*/
&nbsp;
gpii.settingsHandlers.transformOneSolutionSettings = <span class="fstat-no" title="function not covered" >fu</span>nction (oneSolution, handler, path) {
<span class="cstat-no" title="statement not covered" >    path = path || [];</span>
    var togo = <span class="cstat-no" title="statement not covered" >fluid.censorKeys(oneSolution, "settings");</span>
<span class="cstat-no" title="statement not covered" >    togo.settings = fluid.transform(oneSolution.settings, <span class="fstat-no" title="function not covered" >fu</span>nction (oneSetting, settingKey) {</span>
        var innerPath = <span class="cstat-no" title="statement not covered" >path.concat(["settings", settingKey]);</span>
<span class="cstat-no" title="statement not covered" >        return handler(oneSetting, innerPath, oneSolution);</span>
    });
<span class="cstat-no" title="statement not covered" >    return togo;</span>
};
&nbsp;
/** As for gpii.settingsHandlers.transformPayload, only the transform runs one level deeper and iterates over any
 * "settings" block held within the payload.
 */
&nbsp;
gpii.settingsHandlers.transformPayloadSettings = <span class="fstat-no" title="function not covered" >fu</span>nction (payload, handler) {
<span class="cstat-no" title="statement not covered" >    return gpii.settingsHandlers.transformPayload(payload, <span class="fstat-no" title="function not covered" >fu</span>nction (oneSolution, path) {</span>
<span class="cstat-no" title="statement not covered" >        return gpii.settingsHandlers.transformOneSolutionSettings(oneSolution, handler, path);</span>
    });
};
&nbsp;
/** Extract just the settings (eliminating "options") from the nested settingsHandler blocks for a full payload (top-level keys are solution ids)
  * - this is used from gpii.settingsHandlers.comparePayloads and gpii.test.checkConfiguration
  */
&nbsp;
gpii.settingsHandlers.extractSettingsBlocks = <span class="fstat-no" title="function not covered" >fu</span>nction (payload) {
<span class="cstat-no" title="statement not covered" >    return gpii.settingsHandlers.transformPayload(payload, <span class="fstat-no" title="function not covered" >fu</span>nction (oneSolution) {</span>
<span class="cstat-no" title="statement not covered" >        return fluid.filterKeys(oneSolution, "settings");</span>
    });
};
&nbsp;
// A utility which will accept a payload and convert all leaf values to numbers which may validly be. This
// is useful for settings handlers such as the INI settings handler which only really have a concept of strings
// as leaf values - without this postprocessing, roundtripping data through the handler is harder. This is
// primarly just a courtesy to make mock settings handlers easier to write.
gpii.settingsHandlers.numberify = <span class="fstat-no" title="function not covered" >fu</span>nction (payload) {
<span class="cstat-no" title="statement not covered" >    if (typeof(payload) === "string") {</span>
<span class="cstat-no" title="statement not covered" >        return isFinite(payload) ? Number(payload) : payload;</span>
    } else <span class="cstat-no" title="statement not covered" >if (fluid.isPrimitive(payload)) {</span>
<span class="cstat-no" title="statement not covered" >        return payload;</span>
    } else {
<span class="cstat-no" title="statement not covered" >        return fluid.transform(payload, <span class="fstat-no" title="function not covered" >fu</span>nction (value) {</span>
<span class="cstat-no" title="statement not covered" >            return gpii.settingsHandlers.numberify(value);</span>
        });
    }
};
&nbsp;
/** A general utility for invoking a settings handler, given a function for handling a single setting
 * @param handler A function processing a single solution's entries
 * @param payload The full payload as supplied to the settings handler's top-level method
 * @return A promise yielding the combined payload expected from a top-level settings handler - this
 * will resolve synchronously if the supplied handler function is synchronous ("ZALGO" notwithstanding)
 **/
&nbsp;
gpii.settingsHandlers.invokeSettingsHandler = <span class="fstat-no" title="function not covered" >fu</span>nction (handler, payload) {
    var worklist = <span class="cstat-no" title="statement not covered" >[];</span>
    var response = <span class="cstat-no" title="statement not covered" >gpii.settingsHandlers.transformPayload(payload, <span class="fstat-no" title="function not covered" >fu</span>nction (element, path) {</span>
        // Note shallow copy performed within filterKeys
        var directLoad = <span class="cstat-no" title="statement not covered" >fluid.filterKeys(element, ["settings", "options"]);</span>
        var others = <span class="cstat-no" title="statement not covered" >fluid.censorKeys(element, ["settings", "options"]);</span>
<span class="cstat-no" title="statement not covered" >        worklist.push({</span>
            path: path,
            result: handler(directLoad),
            others: others
        });
<span class="cstat-no" title="statement not covered" >        return {}; </span>// construct isomorphic skeleton of response
    });
    var sequence = <span class="cstat-no" title="statement not covered" >fluid.promise.sequence(fluid.getMembers(worklist, "result"));</span>
    var togo = <span class="cstat-no" title="statement not covered" >fluid.promise();</span>
<span class="cstat-no" title="statement not covered" >    sequence.then(<span class="fstat-no" title="function not covered" >fu</span>nction (resolved) {</span>
<span class="cstat-no" title="statement not covered" >        fluid.each(resolved, <span class="fstat-no" title="function not covered" >fu</span>nction (oneResolve, i) {</span>
            // shallow copy to avoid trashing any "undefined" values in returned payload
            var combined = <span class="cstat-no" title="statement not covered" >fluid.extend({settings: oneResolve}, worklist[i].others);</span>
<span class="cstat-no" title="statement not covered" >            fluid.set(response, worklist[i].path, combined);</span>
        });
<span class="cstat-no" title="statement not covered" >        togo.resolve(response);</span>
    }, togo.reject);
<span class="cstat-no" title="statement not covered" >    return togo;</span>
};
&nbsp;
/** Utilities for converting to and from concrete settings to ChangeApplier requests
 * to enact those settings. On the "get" or "set" settingsHandler returns, we receive
 * concrete settings, which need to be modelised so that they can safely be stored and persisted.
 * In future, the "set" action will accept these requests as they are, but for now we need to
 * convert them back using "changesToSettings" to adapt to the historical API.
 */
&nbsp;
// Firstly two utilities which transform an individual settings value from one format to the other
&nbsp;
gpii.settingsHandlers.settingsToChanges = <span class="fstat-no" title="function not covered" >fu</span>nction (element) {
<span class="cstat-no" title="statement not covered" >    return element === undefined ? {</span>
        type: "DELETE"
    } : {
        type: "ADD",
        value: element
    };
};
&nbsp;
gpii.settingsHandlers.changesToSettings = <span class="fstat-no" title="function not covered" >fu</span>nction (element) {
<span class="cstat-no" title="statement not covered" >    return element.type === "DELETE" ? undefined : element.value;</span>
};
&nbsp;
// Secondly two utilities which do the same for an entire solution's worth of payloads as used in the LifecycleManager
&nbsp;
gpii.settingsHandlers.settingsPayloadToChanges = <span class="fstat-no" title="function not covered" >fu</span>nction (response) {
<span class="cstat-no" title="statement not covered" >    return gpii.settingsHandlers.transformPayloadSettings(response, gpii.settingsHandlers.settingsToChanges);</span>
};
&nbsp;
gpii.settingsHandlers.changesPayloadToSettings = <span class="fstat-no" title="function not covered" >fu</span>nction (response) {
<span class="cstat-no" title="statement not covered" >    return gpii.settingsHandlers.transformPayloadSettings(response, gpii.settingsHandlers.changesToSettings);</span>
};
&nbsp;
&nbsp;
/** Invoked by, e.g., the LifecycleManager to convert the SET response from a settingsHandler
 * to a form where it can be immediately relayed back to another SET handler to
 * restore the original settings values
 */
&nbsp;
gpii.settingsHandlers.setResponseToSnapshot = <span class="fstat-no" title="function not covered" >fu</span>nction (response) {
<span class="cstat-no" title="statement not covered" >    return gpii.settingsHandlers.transformPayloadSettings(response, <span class="fstat-no" title="function not covered" >fu</span>nction (element) {</span>
<span class="cstat-no" title="statement not covered" >        return element.oldValue;</span>
    });
};
&nbsp;
&nbsp;
/************************************************************************
 * Utilities for automatically retrying settings handlers.
 * the entry point "invokeRetryingHandler" accepts the materials for invoking
 * a SET settings handler and converts them to a more deferred promise that will
 * repeatedly reread the settings via GET until they match those expected.
 */
&nbsp;
gpii.settingsHandlers.comparePayloads = <span class="fstat-no" title="function not covered" >fu</span>nction (payload1, payload2) {
    var settings1 = <span class="cstat-no" title="statement not covered" >gpii.settingsHandlers.extractSettingsBlocks(payload1);</span>
    var settings2 = <span class="cstat-no" title="statement not covered" >gpii.settingsHandlers.extractSettingsBlocks(payload2);</span>
    var equal = <span class="cstat-no" title="statement not covered" >fluid.model.diff(settings1, settings2);</span>
<span class="cstat-no" title="statement not covered" >    if (!equal) {</span>
<span class="cstat-no" title="statement not covered" >        fluid.log(fluid.logLevel.WARN, "Comparing payload ", JSON.stringify(settings1, null, 2), " with ", JSON.stringify(settings2, null, 2), " equal: " + equal);</span>
    }
<span class="cstat-no" title="statement not covered" >    return equal;</span>
};
&nbsp;
gpii.settingsHandlers.checkRereadSettings = <span class="fstat-no" title="function not covered" >fu</span>nction (that) {
<span class="cstat-no" title="statement not covered" >    if (that.retryOptions.rewriteEvery &amp;&amp; !fluid.resolveContext("gpii.contexts.test", that)) {</span>
<span class="cstat-no" title="statement not covered" >        fluid.fail("rewriteEvery is set to " + that.retryOptions.rewriteEvery</span>
            + ": this facility should only be used in integration or unit tests");
    }
    // Note that this feature is now configured away as described in GPII-2522, although it is still (partially) tested
    var writeAttempt = <span class="cstat-no" title="statement not covered" >that.retryOptions.rewriteEvery &amp;&amp; (that.retries % that.retryOptions.rewriteEvery === 0);</span>
<span class="cstat-no" title="statement not covered" >    if (writeAttempt) {</span>
<span class="cstat-no" title="statement not covered" >        fluid.log(fluid.logLevel.WARN,</span>
            "Stored settings have not settled to required values at attempt " + that.retries +
            ": attempting to rewrite");
    }
    // TODO: This will currently corrupt the SET response of a genuinely async set handler
    var response = <span class="cstat-no" title="statement not covered" >gpii.resolveSync(fluid.invokeGlobalFunction(that.resolvedName + (writeAttempt ? ".set" : ".get"), [that.payload]));</span>
    var getResponse = <span class="cstat-no" title="statement not covered" >writeAttempt ? gpii.settingsHandlers.setResponseToSnapshot(response) : response;</span>
    var equal = <span class="cstat-no" title="statement not covered" >gpii.settingsHandlers.comparePayloads(getResponse, that.payload);</span>
<span class="cstat-no" title="statement not covered" >    if (equal) {</span>
<span class="cstat-no" title="statement not covered" >        that.togo.resolve(that.originalSetPayload);</span>
    } else {
<span class="cstat-no" title="statement not covered" >        ++that.retries;</span>
<span class="cstat-no" title="statement not covered" >        if (that.retries === that.retryOptions.numRetries) {</span>
<span class="cstat-no" title="statement not covered" >            fluid.log(fluid.logLevel.WARN, "Maximum retry count exceeded in settings handler " +</span>
                that.resolvedName + " at retry " + that.retries + ": rejecting settings action");
<span class="cstat-no" title="statement not covered" >            that.togo.reject({</span>
                isError: true,
                message: "Failure to read settings for handler " + that.resolvedName + " as written after " + that.retries + " retries"
            });
        } else {
<span class="cstat-no" title="statement not covered" >            fluid.log(fluid.logLevel.WARN, "Settings have not settled to required values - retrying read at attempt " +</span>
                that.retries + " of " + that.retryOptions.numRetries + " in " + that.retryOptions.retryInterval + "ms");
<span class="cstat-no" title="statement not covered" >            gpii.invokeLater(that.checkRereadSettings, that.retryOptions.retryInterval);</span>
        }
    }
};
&nbsp;
/**
 * Called to invoke settings handlers. Based on the first verifySettings option found in the payload,
 * the settingshandler will be invoked with retrying enabled (if true) or without it (false).
 * Structure of 'payload' argument is:
 * {
 *    "some.app.id": [{
 *         "settings": { ... },
 *         "options": {
 *             ...,
 *            "verifySettings": true
 *         }
 *    }]
 *  }
 * @param resolvedName {String} The resolved "trunk name" of the settings handler to be invoked - e.g. gpii.windows.registrySettingsHandler
 * @param payload {Object} The full payload that would be sent to the SET method of the settings handler
 * @param retryOptions {Object} (optional) Options governing the retry behaviour of the wrapped handler. This contains fields:
 *     numRetries {Integer} A positive integer holding the total number of retries to make
 *     retryInterval {Integer} A positive integer holder the delay in milliseconds between each retry
 * @return a promise that will yield the original payload of the invoked SET method. In the case
 *     that retrying is enabled, a rejection occurs if the GET payloads never match after the end of the nominated retry period
 */
gpii.settingsHandlers.dispatchSettingsHandler = <span class="fstat-no" title="function not covered" >fu</span>nction (resolvedName, payload, retryOptions) {
    // TODO "gpii.lifecycleManager.specToSettingsHandler" is the one responsible for this awkward
    //   layout of the settings handler payload - all of this infrastructure will have to be updated
    //   and cleaned up at some point
<span class="cstat-no" title="statement not covered" >    try {</span>
        var solutionIds = <span class="cstat-no" title="statement not covered" >fluid.keys(payload);</span>
        var verifySettings = <span class="cstat-no" title="statement not covered" >fluid.get(payload, [solutionIds[0], 0, "options", "verifySettings"]);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        return verifySettings ?</span>
            gpii.settingsHandlers.invokeRetryingHandler(resolvedName, payload, retryOptions) :
            gpii.settingsHandlers.invokeSetHandler(resolvedName, payload);
    } catch (e) {
<span class="cstat-no" title="statement not covered" >        fluid.log(fluid.logLevel.WARN, "Error received when dispatching settingsHandler " + resolvedName + " with payload ",</span>
            payload, ": " + e);
<span class="cstat-no" title="statement not covered" >        return fluid.promise().reject(e);</span>
    }
};
&nbsp;
gpii.settingsHandlers.invokeSetHandler = <span class="fstat-no" title="function not covered" >fu</span>nction (resolvedName, payload) {
<span class="cstat-no" title="statement not covered" >    return gpii.toPromise(fluid.invokeGlobalFunction(resolvedName + ".set", [payload]));</span>
};
&nbsp;
/** Main entry point for applying an automatically retrying settings handlers.
 * @param resolvedName {String} The resolved "trunk name" of the settings handler to be invoked - e.g. gpii.windows.registrySettingsHandler
 * @param payload {Object} The full payload that would be sent to the SET method of the settings handler
 * @param retryOptions {Object} Options governing the retry behaviour of the wrapped handler. This contains fields:
 *     numRetries {Integer} A positive integer holding the total number of retries to make
 *     retryInterval {Integer} A positive integer holder the delay in milliseconds between each retry
 * @return a promise that will yield the original payload of the originally invoked SET method if the GET calls eventually produce a result
 * that matches, or else a rejection if the GET payloads never match after the end of the nominated retry period
 */
gpii.settingsHandlers.invokeRetryingHandler = <span class="fstat-no" title="function not covered" >fu</span>nction (resolvedName, payload, retryOptions) {
    var that = <span class="cstat-no" title="statement not covered" >{</span>
        retryOptions: retryOptions,
        retries: 1,
        payload: payload,
        resolvedName: resolvedName,
        togo: fluid.promise(),
        checkRereadSettings: <span class="fstat-no" title="function not covered" >fu</span>nction () {
<span class="cstat-no" title="statement not covered" >            gpii.settingsHandlers.checkRereadSettings(that);</span>
        }
    };
    var originalResponse = <span class="cstat-no" title="statement not covered" >gpii.settingsHandlers.invokeSetHandler(resolvedName, payload);</span>
<span class="cstat-no" title="statement not covered" >    originalResponse.then(<span class="fstat-no" title="function not covered" >fu</span>nction (setPayload) {</span>
<span class="cstat-no" title="statement not covered" >        that.originalSetPayload = setPayload;</span>
<span class="cstat-no" title="statement not covered" >        that.checkRereadSettings();</span>
    });
<span class="cstat-no" title="statement not covered" >    return that.togo;</span>
};
&nbsp;
/****************************************************************
 * Two moderately generic utilities for handling "standard" settings handlers whose
 * data is backed by some kind of free-form in-memory JSON-like structure. These are called
 * called by the file-based getters and setters.
 */
&nbsp;
gpii.settingsHandlers.getSettings = <span class="fstat-no" title="function not covered" >fu</span>nction (solutionEntry, currentSettings) {
    var newSettingsResponse = <span class="cstat-no" title="statement not covered" >{};</span>
    var userRequestedSettings = <span class="cstat-no" title="statement not covered" >solutionEntry.settings;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    fluid.each(userRequestedSettings, <span class="fstat-no" title="function not covered" >fu</span>nction (settingVal, settingKey) {</span>
        var value = <span class="cstat-no" title="statement not covered" >fluid.get(currentSettings, settingKey, fluid.model.escapedGetConfig);</span>
<span class="cstat-no" title="statement not covered" >        newSettingsResponse[settingKey] = value;</span>
    });
&nbsp;
<span class="cstat-no" title="statement not covered" >    return {</span>
        settings: newSettingsResponse
    };
};
&nbsp;
gpii.settingsHandlers.setSettings = <span class="fstat-no" title="function not covered" >fu</span>nction (solutionEntry, currentSettings) {
    var newSettingsResponse = <span class="cstat-no" title="statement not covered" >{};</span>
    var userRequestedSettings = <span class="cstat-no" title="statement not covered" >solutionEntry.settings;</span>
    var options = <span class="cstat-no" title="statement not covered" >solutionEntry.options;</span>
    var holder = <span class="cstat-no" title="statement not covered" >{</span>
        model: currentSettings
    };
    var applier = <span class="cstat-no" title="statement not covered" >fluid.makeHolderChangeApplier(holder, {</span>
        resolverGetConfig: fluid.model.escapedGetConfig,
        resolverSetConfig: fluid.model.escapedSetConfig
    });
&nbsp;
    // record differences between required and default settings
    // so that the default settings can be restored
<span class="cstat-no" title="statement not covered" >    fluid.each(userRequestedSettings, <span class="fstat-no" title="function not covered" >fu</span>nction (settingVal, settingKey) {</span>
        var oldValue = <span class="cstat-no" title="statement not covered" >fluid.get(holder.model, settingKey, fluid.model.escapedGetConfig);</span>
        var change = <span class="cstat-no" title="statement not covered" >{</span>
            path: settingKey,
            value: settingVal
        };
<span class="cstat-no" title="statement not covered" >        change.type = settingVal === undefined ? "DELETE" : "ADD";</span>
<span class="cstat-no" title="statement not covered" >        applier.fireChangeRequest(change);</span>
<span class="cstat-no" title="statement not covered" >        newSettingsResponse[settingKey] = {</span>
            "oldValue": oldValue,
            "newValue": settingVal
        };
    });
<span class="cstat-no" title="statement not covered" >    if (currentSettings !== holder.model) {</span>
        // TODO: Re-understand again exactly why this is, and eliminate it
<span class="cstat-no" title="statement not covered" >        fluid.clear(currentSettings); </span>// We have a silly model based on object reference identity
<span class="cstat-no" title="statement not covered" >        fluid.extend(currentSettings, holder.model);</span>
    }
<span class="cstat-no" title="statement not covered" >    return { options: options, settings: newSettingsResponse };</span>
};
&nbsp;
&nbsp;
&nbsp;
/**************** FILE DEPENDENCE BELOW THIS POINT *********************/
&nbsp;
gpii.settingsHandlers.readFile = <span class="fstat-no" title="function not covered" >fu</span>nction (options) {
<span class="cstat-no" title="statement not covered" >    if (!options || !options.filename) {</span>
<span class="cstat-no" title="statement not covered" >        fluid.fail("readFile: expected an options block defining filename and encoding");</span>
    } else <span class="cstat-no" title="statement not covered" >if (!fs.existsSync(options.filename)) {</span>
<span class="cstat-no" title="statement not covered" >        fluid.log("readFile: No settingsfile '", options.filename, "'' exists. reporting " +</span>
            "'undefined' as current settings");
<span class="cstat-no" title="statement not covered" >        return undefined;</span>
    }
&nbsp;
    // TODO check for and handle read errors
    var content = <span class="cstat-no" title="statement not covered" >fs.readFileSync(options.filename, options.encoding || "utf-8");</span>
<span class="cstat-no" title="statement not covered" >    return content;</span>
};
&nbsp;
gpii.settingsHandlers.writeFile = <span class="fstat-no" title="function not covered" >fu</span>nction (content, options) {
<span class="cstat-no" title="statement not covered" >    if (!options || !options.filename) {</span>
<span class="cstat-no" title="statement not covered" >        fluid.fail("writeFile: expected an options block defining filename and encoding");</span>
    }
    // TODO check for and handle write errors.
<span class="cstat-no" title="statement not covered" >    fs.writeFileSync(options.filename, content, options.encoding || "utf-8");</span>
};
&nbsp;
&nbsp;
/**
 * Utility for file-based settings handler. Handle individual solution entry data. The 'modifier' function passed as
 * parameter is called to allow editing of the solutionEntry based on the
 * current settings (both passed as parameters to the modifier function)
 */
gpii.settingsHandlers.handleFileSolutionEntry = <span class="fstat-no" title="function not covered" >fu</span>nction (solutionEntry, modifier, parser, isWrite) {
    var options = <span class="cstat-no" title="statement not covered" >solutionEntry.options;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (options &amp;&amp; (options.path || options.filename)) {</span>
        // read file - returns undefined if it doesn't exist
        var content = <span class="cstat-no" title="statement not covered" >gpii.settingsHandlers.readFile(options);</span>
        // if the file is non-existing, current settings are {}, else they're the parsed content of the file
        var currentSettings = <span class="cstat-no" title="statement not covered" >(content === undefined) ? {} : parser.parse(content, options);</span>
&nbsp;
        // modification of the entry
        var settings = <span class="cstat-no" title="statement not covered" >modifier(solutionEntry, currentSettings);</span>
<span class="cstat-no" title="statement not covered" >        if (isWrite) {</span>
<span class="cstat-no" title="statement not covered" >            solutionEntry.settings = currentSettings;</span>
            var settingsData = <span class="cstat-no" title="statement not covered" >parser.stringify(currentSettings, options);</span>
<span class="cstat-no" title="statement not covered" >            gpii.settingsHandlers.writeFile(settingsData, options);</span>
        }
<span class="cstat-no" title="statement not covered" >        return settings;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return solutionEntry;</span>
};
&nbsp;
/**
 * Function for looping through the payload sent to get/set calls. Looping
 * is done by fluid.transform calls, and at the level of each solution
 * entry.
 */
gpii.settingsHandlers.transformFilePayload = <span class="fstat-no" title="function not covered" >fu</span>nction (payload, modifier, parser, isWrite) {
<span class="cstat-no" title="statement not covered" >    return gpii.settingsHandlers.transformPayload(payload, <span class="fstat-no" title="function not covered" >fu</span>nction (solutionEntry) {</span>
<span class="cstat-no" title="statement not covered" >        return gpii.settingsHandlers.handleFileSolutionEntry(solutionEntry, modifier, parser, isWrite);</span>
    });
};
&nbsp;
gpii.settingsHandlers.makeFileGet = function (parser) {
    return <span class="fstat-no" title="function not covered" >fu</span>nction (payload) {
<span class="cstat-no" title="statement not covered" >        return gpii.settingsHandlers.transformFilePayload(payload, gpii.settingsHandlers.getSettings, parser);</span>
    };
};
&nbsp;
gpii.settingsHandlers.makeFileSet = function (parser) {
    return <span class="fstat-no" title="function not covered" >fu</span>nction (payload) {
<span class="cstat-no" title="statement not covered" >        return gpii.settingsHandlers.transformFilePayload(payload, gpii.settingsHandlers.setSettings, parser, true);</span>
    };
};
&nbsp;
/**
 * Given two settingsHandler blocks, copy the settings (even those with a value of undefined) from
 * the source to the target - overwriting the target settings. Note that the keys/values immediately
 * within the source settingshandler block (i.e. the named settinghandler sub blocks) must be present
 * in the target block structure
 * Also note that the target object *will be modified*
 */
gpii.settingsHandlers.copySettings = <span class="fstat-no" title="function not covered" >fu</span>nction (target, source) {
<span class="cstat-no" title="statement not covered" >    for (var shName in source) {</span>
        var shBlock = <span class="cstat-no" title="statement not covered" >source[shName];</span>
<span class="cstat-no" title="statement not covered" >        for (var setting in shBlock.settings) { // will loop over undefined vals</span>
<span class="cstat-no" title="statement not covered" >            target[shName].settings[setting] = shBlock.settings[setting];</span>
        }
    }
};
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Mon Mar 12 2018 14:05:59 GMT+0100 (CET)
</div>
</div>
<script src="../../../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../../../sorter.js"></script>
</body>
</html>
